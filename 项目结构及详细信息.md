# Schwefel函数优化项目结构

## 1. 项目概述

本项目实现了一个基于协同模拟退火(Cooperative Simulated Annealing, CSA)结合主动学习(Active Learning)的高维Schwefel函数优化系统。该系统使用替代模型(Surrogate Model)来减少对目标函数的直接调用，提高优化效率。

## 2. 文件结构

```
schwefel/
├── main.py                     # 主程序入口
├── objective_function.py       # 目标函数（Schwefel函数）定义
├── search_strategy.py          # 搜索策略实现，包含基础策略和CSA实现
├── surrogate_model.py          # 替代模型实现
├── utils.py                    # 工具函数
├── visualization.py            # 可视化工具
├── results/                    # 结果保存目录
    ├── data/                   # 采样数据和训练数据
    └── plots/                  # 可视化图表
```

## 3. 模块依赖关系

- **main.py**: 依赖于search_strategy.py和objective_function.py
- **search_strategy.py**: 依赖于surrogate_model.py和objective_function.py
- **surrogate_model.py**: 依赖于sklearn库和numpy
- **objective_function.py**: 依赖于numpy
- **visualization.py**: 依赖于matplotlib和numpy

## 4. 类和函数结构

### 4.1 核心类

- **ObjectiveFunction** (objective_function.py): 目标函数定义
  - 提供Schwefel函数的计算
  - 跟踪函数调用次数

- **SearchStrategy** (search_strategy.py): 搜索策略基础类
  - 定义搜索策略的基本接口
  - 提供样本管理功能

- **SimulatedAnnealingSearch** (search_strategy.py): 模拟退火搜索
  - 实现一维和多维模拟退火
  - 提供候选解生成和评估功能

- **ActiveLearningOptimizer** (search_strategy.py): 主动学习优化器
  - 继承自SearchStrategy
  - 整合替代模型和CSA进行优化

- **SurrogateModel** (surrogate_model.py): 替代模型
  - 基于高斯过程回归实现
  - 提供训练和预测功能

### 4.2 核心功能流程

1. **问题初始化**:
   - 创建ObjectiveFunction实例
   - 配置搜索空间和参数
   - 初始化ActiveLearningOptimizer

2. **优化流程**:
   - 生成初始样本
   - 循环执行以下步骤:
     - 训练替代模型
     - 使用CSA生成候选解
     - 评估候选解并更新训练数据
     - 更新最优解

3. **结果输出**:
   - 记录最优解和优化过程
   - 可视化优化轨迹

## 5. 关键算法实现

### 5.1 协同模拟退火(CSA)

CSA通过分解高维问题为多个低维子问题，采用轮询的方式优化每个维度，提高了高维优化的效率。在本实现中，对每个维度独立使用一维模拟退火搜索。

### 5.2 主动学习

主动学习通过智能选择最有价值的样本点进行评估，减少对昂贵函数评估的次数。在本项目中，使用替代模型预测和不确定性估计来引导样本选择。

### 5.3 替代模型

高斯过程回归作为替代模型，提供函数值预测及预测不确定性评估，为选择评估点提供依据。

## 6. 数据流

1. **初始样本生成**:
   - 随机生成或加载已有样本
   - 保存到x_samples和y_samples

2. **模型训练**:
   - 使用x_samples和y_samples训练替代模型
   - 计算最佳超参数

3. **候选解生成**:
   - 基于当前最优解和温度参数生成候选解
   - 使用替代模型评估候选解

4. **样本更新**:
   - 选择最有价值的候选解进行实际评估
   - 将新样本添加到x_samples和y_samples

5. **结果保存**:
   - 记录历史最优解和相关统计数据
   - 保存到CSV和JSON文件

## 7. 运行指南

1. **环境准备**:
   ```bash
   pip install numpy scikit-learn matplotlib pandas
   ```

2. **运行优化**:
   ```bash
   python main.py
   ```

3. **参数调整**:
   可在main.py中调整以下参数:
   - dimensions: 问题维度
   - num_initial_samples: 初始样本数
   - num_iterations: 迭代次数
   - initial_temp: 初始温度
   - cooling_rate: 冷却率

## 8. 性能考虑

- **计算复杂度**: 高斯过程回归的训练复杂度为O(n³)，其中n是样本数量，因此样本数量增长需要谨慎。
- **内存使用**: 大量样本可能导致内存消耗增加，尤其是在高维问题中。
- **并行化**: 当前实现未使用并行计算，未来版本可考虑添加。

## 9.可视化输出
所有的可视化结果都保存在以当前时间戳命名的results/[timestamp]文件夹中。所有图表中的文字均采用默认英文字体以避免显示错误。

### 9.1 替代模型可视化

#### 9.1.1 实际值vs预测值散点图
- **描述**：将替代模型预测的函数值与真实函数值绘制在同一个散点图上，并计算Pearson相关系数
- **格式**：X轴为真实值，Y轴为预测值，理想情况下所有点应分布在y=x直线附近
- **文件命名**：`actual_vs_predicted_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **实现函数**：`_plot_actual_vs_predicted`

#### 9.1.2 残差图
- **描述**：展示预测误差(残差=真实值-预测值)与预测值的关系，用于识别模型的预测偏差
- **格式**：X轴为预测值，Y轴为残差值，理想情况下残差应该均匀分布在y=0直线附近
- **文件命名**：`residuals_plot_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **实现函数**：`_plot_residuals`

#### 9.1.3 模型训练损失曲线
- **描述**：展示替代模型在训练过程中损失函数的变化趋势
- **格式**：X轴为训练轮次(epoch)，Y轴为损失值，包括训练损失和验证损失（如果有）
- **文件命名**：`model_training_loss_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **训练轮次**：每次迭代训练400轮epochs
- **实现函数**：`_plot_model_training_loss`

### 9.2 搜索策略可视化

#### 9.2.1 CSA维度优化热力图
- **描述**：使用热力图展示每个维度在不同CSA轮次中的最优值变化
- **格式**：X轴为维度索引(0-19)，Y轴为CSA轮次(0-9)，颜色深浅表示值的大小
- **文件命名**：`csa_dimension_optimization_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **实现函数**：`_plot_csa_dimension_optimization`

#### 9.2.2 维度最优值变化趋势图
- **描述**：展示每个维度的最优值随CSA轮次的变化趋势
- **格式**：X轴为CSA轮次，Y轴为维度最优值，每个维度用不同颜色的线表示
- **文件命名**：`dimension_best_values_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **实现函数**：`_plot_csa_dimension_optimization`

#### 9.2.3 CSA解演化可视化
- **描述**：使用4×5的子图矩阵，展示20个维度在CSA优化过程中的值变化
- **格式**：每个子图X轴为CSA轮次，Y轴为该维度的值
- **文件命名**：`csa_solution_evolution_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **实现函数**：`_plot_csa_solutions`

#### 9.2.4 CSA解热力图
- **描述**：使用热力图展示所有维度在不同CSA轮次中的值变化
- **格式**：X轴为维度索引(0-19)，Y轴为CSA轮次，颜色表示值的大小
- **文件命名**：`csa_solution_heatmap_iteration_{iteration+1}.png`
- **生成频率**：每次迭代（共3次）都生成一张图
- **实现函数**：`_plot_csa_solutions`

#### 9.2.5 CSA轮次维度优化结果表格
- **描述**：在控制台输出每轮CSA搜索中每个维度的优化结果，包括维度索引、最优值和目标函数值
- **格式**：表格形式，包含维度、最优值、维度目标函数值三列
- **输出频率**：每轮CSA搜索结束后输出一次（每次迭代10轮CSA，共30次表格）
- **实现位置**：`_cooperative_simulated_annealing`方法内

#### 9.2.6 Top20样本CSV文件
- **描述**：保存每次迭代中评估的最优20个样本点的各维度值和目标函数值
- **格式**：CSV文件，包含value列和dim_1到dim_20共21列
- **文件命名**：`top20_samples_iteration_{iteration+1}.csv`
- **生成频率**：每次迭代（共3次）都生成一个文件
- **实现位置**：`optimize`方法内

### 9.3 全局优化可视化

#### 9.3.1 样本分布图
- **描述**：展示所有采样点的分布情况，帮助理解搜索空间的探索程度
- **格式**：三种类型的可视化：散点图、直方图和二维投影
- **文件命名**：在results/[timestamp]目录下的sample_distribution_*.png系列文件
- **生成频率**：优化完成后生成一次
- **实现函数**：`_plot_sample_distribution`

#### 9.3.2 全局最小值曲线
- **描述**：展示优化过程中全局最小值随采样数量的变化趋势
- **格式**：X轴为样本数量，Y轴为当前最优目标函数值
- **文件命名**：`global_minimum_curve.png`
- **生成频率**：优化完成后生成一次
- **实现函数**：`_plot_global_minimum_curve`

#### 9.3.3 替代模型误差曲线
- **描述**：展示优化过程中替代模型的预测误差变化
- **格式**：X轴为迭代次数，Y轴为RMSE误差
- **文件命名**：`surrogate_model_error.png`
- **生成频率**：优化完成后生成一次
- **实现函数**：`_plot_surrogate_error`

